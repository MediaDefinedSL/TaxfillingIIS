
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@using System.Security.Claims
@using Microsoft.AspNetCore.Html
@using System.Globalization
@{
    var userName = User.FindFirst(ClaimTypes.Name)?.Value;
    var userId = User.Claims.FirstOrDefault(mbox => mbox.Type == "UserID")?.Value;
    bool isAuthenticated = !string.IsNullOrEmpty(userId);
    var apiUrl = Configuration["BaseAPIUrl"];
    var fileSiteUrl = Configuration["FileSiteUrl"];
    var mailUrl = Configuration["MailUrl"];
    var tinNo = User.Claims.FirstOrDefault(c => c.Type == "TinNo")?.Value;
    // var userUploadDocStatus = User.FindFirst("UserUploadDocStatus")?.Value;
    //int docStatus = int.TryParse(userUploadDocStatus, out var parsedStatus) ? parsedStatus : -1;
    int docStatus = ViewBag.UploadedDocStatus ?? -1;
    int personalInfoCompletedStatus = ViewBag.personalInfoStatus ?? -1;
    var formattedName = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(userName.ToLower());
    var personalTaxAssistedComplete = Context.Session.GetString("personalTaxAssistedComplete") == "1";
    
}
<link href="~/assets/css/tree-container-taxassisted-css.css?v=3" rel="stylesheet">
<main class="main">

    <!-- Page Title -->
    <div class="page-title accent-background">
        <div class="container d-lg-flex justify-content-between align-items-center">
            <div class="col-lg-4 col-md-6">
                <h2 class="mb-2 mb-lg-0 font-weight-bold">Tax Assisted Filing</h2></br>

                <h1 class="mb-2 mb-lg-0">Welcome <span>@formattedName</span></h1>
            </div>
            <div class="col-lg-2 col-md-4">
                <nav class="breadcrumbs">
                    <ol>
                        @* <li><a href="index.html">Home</a></li>
                        <li class="current">Self Online Flow</li> *@
                    </ol>
                </nav>
            </div>
        </div>
    </div><!-- End Page Title -->
    <!-- File my taxes Section -->
    <section id="Self-Online-Flow" class="">
        <div class="sidebar-main">
            <nav class="sidebar d-flex flex-column flex-shrink-0 position-fixed" style="
    /* position: absolute !important; */">
                <button class="toggle-btn" onclick="toggleSidebar()">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <div class="p-4">
                    <!-- <h4 class="logo-text fw-bold mb-0">@ViewBag.packageName</h4>
                    <h4 class="logo-text fw-bold mb-0">@ViewBag.curancy @ViewBag.price</h4>-->
                </div>

                <div class="nav flex-column">

                    <a href="#" class="sidebar-link active text-decoration-none p-3" data-target="dashboard-section">
                        <i class="fas fa-home me-3"></i>
                        <span class="hide-on-collapse">Dashboard</span>
                    </a>

                    <a class="sidebar-link dropdown-btn text-decoration-none p-3" id="btnLoadSection">
                        <i class="bi bi-person-fill-down"></i>
                        <span class="hide-on-collapse">Personal Information</span>
                    </a>

                    <!-- <button id="btnLoadSection" class="dropdown-btn sidebar-link text-decoration-none p-3">
                    <i class="bi bi-person-fill-down"></i> &nbsp;&nbsp;
                    Personal Information
                    </button>-->
                    <div class="dropdown-container ps-4" style="display: none;">
                        <a class="sub-link sidebar-link" id="linkTaxPayer">
                            <i class="bi bi-cash-coin me-2"></i>TaxPayer(s)
                        </a>
                        <a class="sub-link" id="linkMaritalStatus">
                            <i class="bi bi-activity me-2"></i>Marital Status
                        </a>
                        <a class="sub-link" id="linkLastYear">
                            <i class="fas fa-calendar me-2"></i>Last Year
                        </a>
                        <a class="sub-link" id="linkIdentification">
                            <i class="bi bi-person-vcard-fill me-2"></i>Identification
                        </a>
                        <a class="sub-link" id="linkContactInformation">
                            <i class="bi bi-telephone-outbound me-2"></i>Contact Information
                        </a>
                        <a class="sub-link" id="linkSummary">
                            <i class="bi bi-bar-chart-fill me-2"></i>Summary
                        </a>
                    </div>

                    <a href="#documents-submenu" id="linkDocuments"
                       class="sidebar-link text-decoration-none p-3 d-flex justify-content-between align-items-center @(personalTaxAssistedComplete ? "" : "locked")"
                       data-bs-toggle="collapse"
                       aria-expanded="false"
                       data-target="documents-section">
                        
                    
                        <span>
                            <i class="fas fa-chart-bar me-3"></i>
                            <span>Documents</span>
                        </span>
                        <i class="fas fa-chevron-down small"></i>
                    </a>

                    <!-- Sub-links under Documents -->
                    <div class="collapse ps-4" id="documents-submenu">
                        <a href="#" class="sidebar-link text-decoration-none py-2 d-block" data-target="employment-section">
                            <i class="fas fa-briefcase me-2"></i> Employment Docs
                        </a>
                        <a href="#" class="sidebar-link text-decoration-none py-2 d-block" data-target="bank-section">
                            <i class="fas fa-university me-2"></i> Bank Confirmation
                        </a>
                        <a href="#" class="sidebar-link text-decoration-none py-2 d-block" data-target="assets-section">
                            <i class="fas fa-balance-scale me-2"></i> Assets & Liabilities
                        </a>
                        <a href="#" class="sidebar-link text-decoration-none py-2 d-block" data-target="other-section">
                            <i class="fas fa-folder me-2"></i> Other Docs
                        </a>
                    </div>

                    <a href="#" class="sidebar-link active text-decoration-none p-3" data-target="declaration-section">
                        <i class="fas fa-file-signature me-2"></i>
                        <span class="hide-on-collapse">Declaration</span>
                    </a>


                </div>

                <div class="profile-section mt-auto p-4">
                    <div class="d-flex align-items-center">
                        <img src="https://randomuser.me/api/portraits/women/70.jpg" style="height:60px" class="rounded-circle" alt="Profile">
                        <div class="ms-3 profile-info">
                            <h6 class="text-white mb-0">Alex Morgan</h6>
                            <small class="text-muted">Admin</small>
                        </div>
                    </div>
                </div>
            </nav>



            <main class="main-content">
                <div class="container-fluid">
                    <div id="dashboard-section" class="content-panel p-4 bg-light rounded shadow-sm">
                        <div class="mt-0">
                            <div class="d-flex align-items-center mb-3">
                                <h4 class="mb-0 mx-auto">Individual Income Tax Filing Summary</h4>

                                <div style="display:none;">
                                    <button class="btn btn-primary me-2">Continue filing</button>
                                    <button class="btn btn-danger" id="btnRemoveDraft">Remove draft</button>
                                </div>
                            </div>
                            <div class="user-details-section mb-4">
                                <table class="table table-borderless site-color mx-auto" style="width: auto;">
                                    <thead>
                                        <tr>
                                            <th scope="col"><strong>Taxpayer Identification Number (TIN)</strong></th>
                                            <td class="text-center">@tinNo</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row"><strong>Name of Taxpayer</strong></th>
                                            <td class="text-center">@userName</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Current Year Info -->
                            <!-- Four separate info boxes -->
                            <!-- Four equal-sized info boxes -->
                        <div class="row mb-4 align-items-stretch">
                            <div class="col-md-3">
                                <div class="card text-center shadow-sm h-100 border-primary border-2 rounded-3 card-hover">
                                    <div class="card-body d-flex flex-column justify-content-center">
                                        <h6 class="card-title">Year of Assessment</h6>
                                        <p class="fs-5 fw-bold">2024/2025</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="card text-center shadow-sm h-100 border-danger border-2 rounded-3 card-hover">
                                    <div class="card-body d-flex flex-column justify-content-center">
                                        <h6 class="card-title">Due Date</h6>
                                        <p class="fs-5 fw-bold">11/30/2025</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="card text-center shadow-sm h-100 border-success border-2 rounded-3 card-hover">
                                    <div class="card-body d-flex flex-column justify-content-center">
                                        <h6 class="card-title">Status</h6>
                                        <span id="statusBadge" class="badge px-2 py-1"></span>
                                    </div>
                                </div>
                            </div>

                           

                                <script>
                                     const docStatus = @docStatus;
                                     const badge = document.getElementById("statusBadge");

                                    // if (badge && docStatus) {
                                     switch (docStatus) {
                                     case 1:
                                     badge.className = "badge bg-warning text-dark px-2 py-1";
                                     badge.textContent = "Draft";
                                     break;
                                     case 2:
                                     badge.className = "badge bg-success text-light px-2 py-1";
                                     badge.textContent = "Submitted";
                                     break;
                                     case 0:
                                     badge.className = "badge bg-info text-dark px-2 py-1";
                                     badge.textContent = "New";
                                     break;
                                     default:
                                     badge.className = "badge bg-secondary text-light px-2 py-1";
                                     badge.textContent = docStatus;
                                     }
                                    // }
                                </script>
                                <div class="col-md-3">
                                    <div class="card text-center shadow-sm h-100 border-info border-2 rounded-3 card-hover">
                                        <div class="card-body d-flex flex-column justify-content-center">
                                            <h6 class="card-title">Uploads</h6>
                                            <a href="#" id="fileCountLink" class="fs-6 fw-bold text-decoration-none"></a>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <p>Select a year to start or continue your return. Past years are read-only.</p>
                            @{
                                int startYear = 2019;
                                int endYear = DateTime.Now.Month >= 4 ? DateTime.Now.Year - 1 : DateTime.Now.Year - 2;
                            }

                            <div class="row">
                                <!-- Left side: Table -->
                                <div class="col-md-8 ">

                                    <!-- Yearly Summary Table -->
                                    <div class="card shadow-sm rounded-3 mb-4 h-100">
                                        <div class="card-body p-0">
                                            <table class="table table-borderless align-middle mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th></th>
                                                        <th>Year of assessment</th>
                                                        <th>Due date</th>
                                                        <th>Progress</th>
                                                        <th class="text-center">Status</th>
                                                        <!--<th class="text-end">Actions</th>-->
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @for (int year = endYear; year >= startYear; year--)
                                                    {
                                                        var dueDate = new DateTime(year + 1, 11, 30).ToString("yyyy-MM-dd");
                                                        var isCurrentAssessmentYear = year == endYear;

                                                        int numericStatus = isCurrentAssessmentYear ? docStatus : 2; // default SUBMITTED for past years

                                                        string status = "SUBMITTED"; // default for past years
                                                        if (isCurrentAssessmentYear)
                                                        {
                                                            status = docStatus switch
                                                            {
                                                                0 => "NEW",
                                                                1 => "DRAFT",
                                                                2 => "SUBMITTED",
                                                                3 => "REUPLOAD",
                                                                4 => "RESUBMITTED",
                                                                _ => "UNKNOWN"
                                                            };
                                                        }

                                                        var badgeClass = status switch
                                                        {
                                                            "NEW" => "bg-info text-dark",
                                                            "DRAFT" => "bg-warning text-dark",
                                                            "SUBMITTED" => "bg-success",
                                                            "REUPLOAD" => "bg-danger-subtle text-danger",
                                                            "RESUBMITTED" => "bg-info-subtle text-info",
                                                            _ => "bg-dark"
                                                        };
                                                        // Unique ID for row and badge
                                                        var rowId = $"assessment-row-{year}";
                                                        var badgeId = $"status-badge-{year}";
                                                        <tr id="@rowId" data-status="@numericStatus">
                                                            <td align="center">
                                                                <input class="checkbox-lg" type="checkbox" @(isCurrentAssessmentYear ? "checked" : "disabled") />
                                                            </td>
                                                            <td>@year/@(year + 1)</td>
                                                            <td>@dueDate</td>
                                                            <td align="center">
                                                                <div class="progress" style="height: 6px;">
                                                                    <div class="progress-bar bg-primary" @(numericStatus == 2 ? "style=width:100%" : "")></div>
                                                                </div>
                                                            </td>
                                                            <td class="text-center">
                                                                <span id="@badgeId" class="badge @badgeClass d-inline-flex justify-content-center align-items-center" style="min-width: 80px;">
                                                                    @status
                                                                </span>
                                                            </td>
                                                            <!--<td class="text-end actionButtons"></td>-->


                                                        </tr>


                                                    }




                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right side: Progress Box -->
                                @{
                                    int currentYear = endYear;
                                    string statusText = docStatus switch
                                    {
                                        0 => "New",
                                        1 => "Draft",
                                        2 => "Submitted",
                                        3 => "Reupload",
                                        4 => "Resubmitted",
                                        _ => "Unknown"
                                    };

                                    string statusClass = docStatus switch
                                    {
                                        0 => "bg-info text-dark",
                                        1 => "bg-warning text-dark",
                                        2 => "bg-success text-white",
                                        3 => "bg-danger text-white",
                                        4 => "bg-info text-dark",
                                        _ => "bg-dark text-white"
                                    };

                                    int progressValue = docStatus switch
                                    {
                                        0 => 20,
                                        1 => 40,
                                        2 => 100,
                                        3 => 60,
                                        4 => 80,
                                        _ => 0
                                    };
                                }

                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <!-- Header with status -->
                                        <div id="progressHeader" class="card-header @statusClass">
                                            @currentYear/@(currentYear + 1) – @statusText
                                        </div>

                                        <div class="card-body">
                                            <p><strong>Progress</strong></p>
                                            <div class="progress mb-3" style="height: 8px;">
                                                <div id="progressBar" class="progress-bar bg-primary" style="width: 0%;"></div>
                                            </div>

                                            <ul class="list-group mb-3">
                                                <li class="list-group-item d-flex justify-content-between">
                                                    Personal information completed
                                                    <span id="personalInfoStatus" class="text-secondary">Checking...</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    Employment income added
                                                    <span id="employmentIncomeStatus" class="text-secondary">Checking...</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    Bank Confirmation uploaded
                                                    <span id="bankConfirmationStatus" class="text-secondary">Checking...</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    Assets & Liabilities added
                                                    <span id="assetsStatus" class="text-secondary">Checking...</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    Other docs uploaded
                                                    <span id="otherDocsStatus" class="text-secondary">Checking...</span>
                                                </li>
                                            </ul>




                                            <!-- Buttons -->
                                            <div class="d-flex gap-2">
                                                @if (docStatus == 1)
                                                {
                                                    <!-- Draft -->
                                                    <button class="btn btn-primary flex-fill" id="btnContinue">Continue filing</button>
                                                    <button class="btn btn-secondary flex-fill" id="btnUploadDocs">Upload documents</button>
                                                    <button class="btn btn-danger flex-fill" id="btnRemoveDft">Remove draft</button>
                                                    <button class="btn btn-info flex-fill" id="btnViewSubmittedDocs" style="display:none">View Docs</button>
                                                }
                                                else if (docStatus == 2)
                                                {
                                                    <!-- Submitted -->
                                                    <button class="btn btn-info flex-fill" id="btnViewSubmittedDocs" style="display:none">
                                                        <i class="fas fa-eye me-1"></i> View Docs
                                                    </button>
                                                }
                                                else if (docStatus == 0)
                                                {
                                                    <!-- New -->
                                                    <button class="btn btn-primary flex-fill" id="btnContinue">Continue filing</button>
                                                    <button class="btn btn-secondary flex-fill" id="btnUploadDocs">Upload documents</button>
                                                    <button class="btn btn-danger flex-fill" id="btnRemoveDft" style="display:none">Remove draft</button>
                                                    <button class="btn btn-info flex-fill" id="btnViewSubmittedDocs" style="display:none">View Docs</button>
                                                }
                                                else
                                                {
                                                    <!-- Other statuses -->
                                                    <button class="btn btn-secondary flex-fill">View Details</button>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

                <!-- Upload Tracker (place inside each section header) -->
                <!-- Global Upload Tracker -->

                <div id="global-upload-tracker">
                    <span class="upload-label">
                        <i class="fas fa-upload me-1 text-primary"></i> Uploaded
                    </span>
                    <span id="globalUploadCount" class="fw-bold text-dark">0 </span>
                    <span class="fw-bold text-dark">files </span>
                </div>

                <div id="in-this-section-container" style="display: none;"></div>
                <div id="documents-section" class="content-panel p-4 bg-light rounded shadow-sm" style="display: none;">
                    <!-- Header Section -->
                    <div class="d-lg-flex justify-content-between align-items-center mb-4">
                        <div class="col-lg-9 col-md-12">
                            <h4>
                                <i class="fas fa-folder-open text-primary me-2"></i> Documents
                            </h4>
                            
                        </div>
                        <div class="col-lg-3 col-md-12 text-lg-end text-md-center mt-3 mt-lg-0">
                            <!-- You can place a summary or help link here -->
                        </div>
                    </div>
                    <div class="alert alert-warning col-md-8 up-pri" role="alert">
                        Files are encrypted in transit and at rest. Only your assigned tax advisor can view them.
                    </div>
                    <!-- Upload Prompt -->
                    <div class="uplode-parts">
                        <div class="row ">

                            <div class="col-md-8 guid-line">

                                <div class="uplode-text">Ensure the following documents are available for upload, as relevant to your case.</div>
                                <ul>
                                    <li><i class="bi bi-check"></i>APIT / PAYE – T10 Certificate (Employment income)</li>
                                    <li><i class="bi bi-check"></i>Bank Confirmation Letters – Savings, Current, Fixed Deposits, Credit Cards, Lease, Loan, WHT certificates </li>
                                    <li><i class="bi bi-check"></i>Rent Income Evidence – Rent agreements, receipts, or statements</li>
                                    <li><i class="bi bi-check"></i>Investment / Dividend Statements – Including unit trusts, share dividends, treasury bills, etc.</li>
                                    <li><i class="bi bi-check"></i>Foreign Income Proof – Payslips, remittance advice, bank credit notices </li>
                                    <li><i class="bi bi-check"></i>Solar Panel Purchase &amp; Donation Receipts – If claiming relevant reliefs</li>
                                    <li><i class="bi bi-check"></i>Tax Payment Evidence – Payment receipts and IRD acknowledgements</li>
                                    <li><i class="bi bi-check"></i>Any Other Supporting Documents relevant for tax filing (e.g., previous year’s tax return,) </li>
                                </ul>
                            </div>

                            <div class="col-md-6 alert alert-primary d-flex align-items-center p-4 shadow-lg border border-2 border-primary rounded-4 uplode-file-s" role="alert" style="background: #e9f4ff;">
                                
                                <div>

                                    
                                    <button class="btn btn-primary btn-lg px-4 py-2" id="uploadDoc-btn">
                                        <i class="fas fa-upload me-2"></i> Upload Documents
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Optional: Additional Details or Instructions -->
                    <div class="mt-4 document-guidelines">
                        <h5><i class="fas fa-info-circle text-secondary me-2"></i>Document Guidelines</h5>
                        <ul class="text-muted">
                            <li><strong>Accepted formats: <strong>PDF, JPG, PNG, PDF, DOC</strong></strong></li>
                            <li><strong>Maximum size per file: <strong>5MB</strong></strong></li>
                           

                        </ul>
                    </div>

                    <div class="d-flex justify-content-between">
                        <div class="col-lg-6 col-md-6 btn-prv">
                            <!-- Previous Button -->
                            <button class="btn btn-primary btn-lg" id="btnDocPrevious">
                                Previous
                            </button>
                        </div>
                        <div class="col-lg-6 col-md-6 right next-btn">
                            <button class="btn btn-primary btn-lg" id="btnDocNext">
                                Next
                            </button>
                        </div>
                    </div>



                </div>

                <div id="employment-section" class="content-panel p-4 bg-light rounded shadow-sm" style="display: none;">
                    <h4>
                        <i class="fas fa-briefcase text-primary me-2"></i> Employment Documents
                    </h4>

                    <div class="custom-tabs mt-3">
                        <!-- Nav Tabs -->
                        <ul class="nav nav-tabs col-md-12" id="employmentTab" role="tablist">
                            <li class="nav-item col-md-2" role="presentation">
                                <button class="nav-link active" id="t10-tab" data-bs-toggle="tab" data-bs-target="#t10" type="button" role="tab" aria-controls="t10" aria-selected="true">
                                    T10
                                </button>
                            </li>
                            <li class="nav-item col-md-2" role="presentation">
                                <button class="nav-link" id="terminal-tab" data-bs-toggle="tab" data-bs-target="#terminal" type="button" role="tab" aria-controls="terminal" aria-selected="false">
                                    Terminal Benefit
                                </button>
                            </li>
                            <li class="nav-item col-md-2" role="presentation">
                                <button class="nav-link" id="anyother-tab" data-bs-toggle="tab" data-bs-target="#anyother" type="button" role="tab" aria-controls="anyother" aria-selected="false">
                                    Any Other
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content mt-3" id="employmentTabContent">
                            <!-- T10 Form -->
                            <div class="tab-pane fade show active" id="t10" role="tabpanel" aria-labelledby="t10-tab">
                                <input type="hidden" name="CategoryName" value="T10" />
                                <div class="mb-3">
                                    <div class="alert alert-info mt-2" role="alert">
                                        <strong>Note:</strong> Please upload your T10 Certificate for the relevant period. If you have multiple T10 Certificates for different employees, kindly upload each separately. <br>
                                        <a href="#" class="text-primary text-decoration-underline" data-bs-toggle="modal" data-bs-target="#t10Modal">
                                            View Sample T10 Certificate
                                        </a>
                                    </div>
                                    <!-- Modal -->
                                    <div class="modal fade" id="t10Modal" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Sample T10 Certificate</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body p-0 text-center">
                                                    <canvas id="pdfCanvas"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- PDF.js -->
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

                                    <script>
                                        const url = "/assets/files/T10.pdf";  // your PDF path
                                        let pdfRendered = false;

                                        function loadPdf() {
                                          const loadingTask = pdfjsLib.getDocument(url);
                                          loadingTask.promise.then(function (pdf) {
                                            // Load first page (you can loop if you want all pages)
                                            pdf.getPage(1).then(function (page) {
                                              const scale = 1.3;
                                              const viewport = page.getViewport({ scale });

                                              const canvas = document.getElementById("pdfCanvas");
                                              const context = canvas.getContext("2d");

                                              canvas.height = viewport.height;
                                              canvas.width = viewport.width;

                                              page.render({
                                                canvasContext: context,
                                                viewport: viewport
                                              });
                                            });
                                          });
                                        }

                                        // Load only once when modal opens
                                        document.getElementById("t10Modal").addEventListener("shown.bs.modal", function () {
                                          if (!pdfRendered) {
                                            loadPdf();
                                            pdfRendered = true;
                                          }
                                        });

                                        // Optional: Reset when modal closes
                                        document.getElementById("t10Modal").addEventListener("hidden.bs.modal", function () {
                                          document.getElementById("pdfCanvas").getContext("2d").clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
                                          pdfRendered = false; // if you want to reload fresh each time
                                        });
                                    </script>
                                    @* <div class="modal fade" id="t10Modal" tabindex="-1" aria-labelledby="t10ModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="t10ModalLabel">Sample T10 Certificate</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body" style="height: 400px;">
                                                    <iframe src="/assets/files/T10.pdf" style="width:100%; height:100%;" frameborder="0"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div> *@
                                    <label>Employer Name</label>
                                    <input type="text" name="T10EmployerName" class="form-control" id="T10EmployerName" />
                                    <form method="post" enctype="multipart/form-data" class="mt-3">
                                        <label>Upload File</label>
                                        <input type="file" id="fileInput" name="UploadedFile" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                    </form>
                                </div>
                            </div>

                            <!-- Terminal Benefit Form -->
                            <div class="tab-pane fade" id="terminal" role="tabpanel" aria-labelledby="terminal-tab"> 
                                <input type="hidden" name="CategoryName" value="TerminalBenefit" />
                                <div class="mb-3">
                                    <label>Employer Name</label>
                                    <input type="text" name="TerminalEmployerName" class="form-control" id="TerminalEmployerName" />
                                    <form method="post" enctype="multipart/form-data" class="mt-3">
                                        <label>Upload File</label>
                                        <input type="file" id="fileInputTerminal" name="UploadedFile" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                    </form>
                                </div>
                            </div>

                            <!-- Any Other Form -->
                            <div class="tab-pane fade" id="anyother" role="tabpanel" aria-labelledby="anyother-tab">
                                <input type="hidden" name="CategoryName" value="AnyOther" />
                                <div class="mb-3">
                                    <label class="form-label">Type</label>
                                    <select class="form-select" name="OtherType" id="AnyOtherType">
                                        <option value="">-- Select Type --</option>
                                        <option value="SalarySlips">Salary Slips</option>
                                        <option value="Otherbenefits">Other benefits received from the employer</option>
                                        <option value="Anyotherdocuments">Any other documents relevant to employment income</option>
                                    </select>
                                    <!-- Message container -->
                                    <div id="otherTypeAlert" class="alert alert-warning mt-2" role="alert" style="display:none;">
                                        Such as a vehicle for private use, a house for residential purposes, and company shares.
                                    </div>
                                    <form method="post" enctype="multipart/form-data" class="mt-3">
                                        <label>Upload File</label>
                                        <input type="file" id="fileInputAnyOther" name="UploadedFile" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload button -->
                    <div class="d-flex justify-content-end mt-3">
                        <button type="button" class="btn btn-primary submit-btn" id="submitBtn">
                            <i class="fas fa-save me-1"></i> Upload
                        </button>
                    </div>

                    <!-- Uploaded docs -->
                    <div id="uploadedDocs" class="mt-5" style="display: none;">
                        <h5 class="mb-3" id="categoryHeading">Your Documents for 2024/2025</h5>
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>Document Name</th>
                                        <th>Category</th>
                                        <th>Employer Name/Any Other Type</th>
                                        <th>Uploaded On</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="documentsTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Prev / Next -->
                    <div class="d-flex justify-content-between mt-3">
                        <div class="col-lg-6 col-md-6 btn-prv">
                            <button class="btn btn-primary btn-lg" id="btnPrevious">Previous</button>
                        </div>
                        <div class="col-lg-6 col-md-6 right next-btn">
                            <button class="btn btn-primary btn-lg" id="btnNext">Next</button>
                        </div>
                    </div>
                </div>


                <div id="bank-section" class="content-panel p-4 bg-light rounded shadow-sm" style="display: none;">
                    <h4><i class="fas fa-university me-2 text-primary me-2"></i> Bank Confirmation</h4>

                    <!-- T10 Form -->
                    <div id="bank-form" class="upload-form-section" style="display: block;">

                        <input type="hidden" name="CategoryName" value="T10" />
                        <div class="mb-3">
                            <label class="form-label">Bank Confirmation Type</label>
                            <select class="form-select" name="BankConfirmationType" id="BankConfirmationType">
                                <option value="">-- Select Type --</option>
                                <option value="Savings and Fixed Deposits">Savings and Fixed Deposits</option>
                                <option value="Loans and Leases">Loans and Leases</option>
                                <option value="Credit Cards">Credit Cards</option>
                                <option value="Money Market Accounts">Money Market Accounts</option>
                                <option value="Unit Trust Accounts">Unit Trust Accounts</option>
                                <option value="Any other">Any other </option>

                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Bank Name</label>
                            <!-- <input type="text" class="form-control" name="BankName" id="BankName" />-->
                            @*  <select id="BankName" name="BankName" class="form-select" style="width:100%">
                                <option value="">-- Select Bank --</option>
                            </select> *@                           

                            <input type="text" id="bankInput" class="form-control form-select" placeholder="Type Bank Name" autocomplete="off" />
                            <div id="bankDropdown" class="dropdown"></div>


                        </div>
                        <!-- Branch -->
                        <div class="mb-3">
                            <label>Branch</label>
                            <input type="text" id="branchInput" class="form-control" placeholder="Choose bank first" autocomplete="off" disabled />
                            <div id="branchDropdown" class="dropdown"></div>
                        </div>

                        <!-- Hidden inputs -->
                        <input type="hidden" id="bank_id" name="bank_id" />
                        <input type="hidden" id="bank_long" name="bank_long" />
                        <input type="hidden" id="branch_code" name="branch_code" />
                        <input type="hidden" id="branch_name" name="branch_name" />


                        @* <div class="mb-3">
                            <label class="form-label">Branch Name</label>
                            <!-- <input type="text" class="form-control" name="BankName" id="BankName" />-->
                            <select id="BranchName" name="BranchName" class="form-select" style="width:100%">
                                <option value="">-- Select Branch --</option>
                            </select>
                        </div> *@
                        <form method="post" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label>Upload File</label>
                                <input type="file" id="fileInputBank" name="UploadedFile" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-primary submit-btn" id="submitBankBtn"><i class="fas fa-save me-1"></i>Upload</button>
                            </div>

                        </form>
                        <div id="uploadedBankDocs" class="mt-5" style="display: none;">
                            <h5 class="mb-3" id="categoryHeading"><span class="text-muted">Your Uploaded</span> <span class="badge bg-primary">Bank Confirmation</span> <span class="text-muted">Documents for 2024/2025</span></h5>
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped mt-2">
                                    <thead class="table-light">
                                        <tr>
                                            <th>#</th>
                                            <th class="col-document-name">Document Name</th>
                                            <th class="col-category">Category</th>
                                            <th class="col-employer-name">Employer Name/Any Other Type</th>
                                            <th class="col-confirmation-type">Bank Confirmation Type</th>
                                            <th class="col-bank-name">Bank Name</th>
                                            <th>Uploaded On</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="documentsTableBankBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <div class="col-lg-6 col-md-6 btn-prv">
                                <!-- Previous Button -->
                                <button class="btn btn-primary btn-lg" id="btnEmployementPrevious">
                                    Previous
                                </button>
                            </div>
                            <div class="col-lg-6 col-md-6 right next-btn">
                                <button class="btn btn-primary btn-lg" id="btnAssestsNext">
                                    Next
                                </button>
                            </div>
                        </div>


                    </div>


                </div>

                <div id="assets-section" class="content-panel p-4 bg-light rounded shadow-sm" style="display: none;">
                    <h4><i class="fas fa-balance-scale me-2 text-primary me-2"></i> Assets & Liabilities</h4>

                    <!-- T10 Form -->
                    <div id="assets-form" class="upload-form-section" style="display: block">

                        <input type="hidden" name="CategoryName" value="T10" />
                        <div class="card p-4 shadow-sm">
                            <!--<h5 class="mb-3">Assets as at <strong>31.03.2025</strong></h5>-->

                            <!-- Local/Foreign checkbox summary -->
                            <!-- <div class="mb-4">
                                <label class="form-label fw-semibold">Select Asset Location (General)</label>
                                <div class="form-check form-check-inline me-4">
                                    <input class="form-check-input bordered-checkbox" type="checkbox" id="summaryLocal">
                                    <label class="form-check-label" for="summaryLocal">A. Local</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input bordered-checkbox" type="checkbox" id="summaryForeign">
                                    <label class="form-check-label" for="summaryForeign">B. Foreign</label>
                                </div>
                            </div>-->
                            <!-- Upload method selection -->
                            <!-- Upload method selection -->
                            <h5 class="mb-3 col-md-10">
                                Please provide your Asset and Liability details as at 31.03.2025 by selecting one of the following options:</h5>
                            <div class="btn-group p-4" role="group">
                                <input type="radio" class="btn-check" name="assetInputOption" id="optionExcel" value="1" autocomplete="off" checked>
                                <label class="btn btn-outline-secondary" for="optionExcel">Enter Asset & Liability Details Using Excel Template</label>

                                <input type="radio" class="btn-check" name="assetInputOption" id="optionManual" value="2" autocomplete="off">
                                <label class="btn btn-outline-secondary" for="optionManual">Upload Supporting Documents for Assets & Liabilities</label>
                            </div>



                            <!-- Excel Upload Section -->
                            <div id="excelUploadSection" class="container ">
                                <div class="card shadow-sm border-0">
                                    <div class="card-body">

                                        <!-- Info Alert with Download Button -->
                                        <div class="alert alert-info d-flex justify-content-between align-items-center">
                                            <span>
                                                <i class="fas fa-download me-2"></i>
                                                Please download and fill out the Excel sheet for Assets & Liabilities.
                                            </span>
                                            <a href="/assets/files/AssetsAndLiabilityTemplate.xlsx" class="btn btn-sm btn-primary">
                                                Download Template
                                            </a>
                                        </div>

                                        <!-- Visible File Input -->
                                        <label for="assetsExcelFile" class="form-label fw-semibold">
                                            Fill in the pre-formatted Excel sheet provided and upload the completed file. No supporting documents are required.
                                        </label>
                                        <input type="file" id="assetsExcelFile" name="assetsExcelFile"
                                               accept=".xlsx" class="form-control mb-2"
                                               onchange="handleExcelFileChange(event)">

                                        <!-- File Name Display -->
                                        <div id="uploadedFileName" class="mb-3 text-muted" style="font-size: 0.9rem;"></div>

                                        <!-- Validation Message -->
                                        <div id="fileValidationMessage" class="text-danger mb-3" style="font-size: 0.9rem;"></div>

                                        <!-- Button Row -->
                                        <div class="d-flex justify-content-end gap-2">
                                            <button type="submit" class="btn btn-success submit-btn" id="submitExcelBtn" disabled>
                                                Submit
                                            </button>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-bordered table-striped mt-3" id="uploadedExcelAssetsTable">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Document Name</th>
                                                        <th>Uploaded On</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Dynamic rows will be inserted here -->
                                                </tbody>
                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Manual Entry Table -->
                            <!-- Redesigned Manual Entry Section with Tabbed Layout -->
                            <div class="manual-entry-container p-4 bg-white shadow rounded" id="manualTableSection">
                                <!-- ✅ Success message block -->
                                @if (TempData["SuccessMessage"] != null)
                                {
                                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                                        @TempData["SuccessMessage"]
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                }

                                <div class="alert alert-info mt-2" role="alert">
                                    <strong>Note:</strong> Please upload all relevant supporting documents (e.g., land deeds, vehicle reports, share balance statements, etc.) to enable us to complete the details on your behalf.
                                </div>
                                <!-- Tab Buttons -->
                                <div class="d-flex gap-2 mb-4" id="manualTabs">
                                    <button type="button" class="btn btn-outline-primary active" id="tabLocal"
                                            onclick="toggleManualTab('local')">
                                        A. Local Assests
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="tabForeign"
                                            onclick="toggleManualTab('foreign')">
                                        B. Foreign Assests
                                    </button>
                                </div>

                                <!-- Tab Content: Local -->
                                <form id="assetForm" enctype="multipart/form-data">
                                    <div id="manualLocalTab" class="tab-pane fade show active" style="display: block;">
                                        <div class="table-responsive">
                                            <table class="table table-bordered align-middle">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 50px; background-color: #4aadfd;color: #fff !important;">#</th>
                                                        <th style="background-color: #4aadfd; color: #fff !important">Asset Category</th>
                                                        <th style="width: 35%;background-color: #4aadfd; color: #fff !important">Value / Notes</th>
                                                        <th style="width: 25%;background-color: #4aadfd; color: #fff !important">Upload</th>
                                                        <th style="width: 5%;background-color: #4aadfd; color: #fff !important">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="table-light align-middle">
                                                        <td class="text-center" style="width: 40px;">1</td>
                                                        <td style="min-width: 220px; font-weight: normal;">
                                                            Deed of land, building, apartment
                                                            <input type="hidden" class="AssetCategory" value="Deed of land, building, apartment" />
                                                        </td>
                                                        <td style="min-width: 280px;">
                                                            <div id="notesContainer-0">
                                                                <input type="text"
                                                                       name="assets[0].Description"
                                                                       class="form-control form-control-sm mb-2"
                                                                       placeholder="Enter value or notes"
                                                                       aria-label="Enter value or notes for asset 1" />
                                                            </div>
                                                        </td>
                                                        <td style="min-width: 220px;">
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file"
                                                                           name="assets[0].Files"
                                                                           class="form-control form-control-sm"
                                                                           aria-label="Upload file for asset 1" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div> <!-- Closing div was missing -->
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(0,1)"
                                                                    aria-label="Upload asset 1"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td>Movable Properties (Motor Vehicles) <input type="hidden" class="AssetCategory" value="Movable Properties (Motor Vehicles)" /</td>
                                                        <td>
                                                            <div id="vehicleNoteContainer-1">
                                                                <div class="vehicle-note-group mb-2 d-flex gap-2">
                                                                    <select class="form-select" name="assets[1].vehicleTypes">
                                                                        <option value="">Select Vehicle Type</option>
                                                                        <option>Motor Car</option>
                                                                        <option>Van</option>
                                                                        <option>Bike</option>
                                                                        <option>Other</option>
                                                                    </select>
                                                                    <input type="text" name="assets[1].Description" class="form-control" placeholder="Value / Description" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[1].Files" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(1,1)"
                                                                    aria-label="Upload asset 2"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr class="table-light align-middle">
                                                        <td>3</td>
                                                        <td>Shares/Stocks/Securities as at 31.03.2025 <input type="hidden" class="AssetCategory" value="Shares/Stocks/Securities" /></td>

                                                        <td>
                                                            <div id="institutionTypeNoteContainer-2">
                                                                <div class="institution-note-group mb-2 d-flex gap-2">
                                                                    <select class="form-select mb-2" name="assets[2].InstitutionType">
                                                                        <option value="">Select Institution</option>
                                                                        <option>Share balances on the Sri Lanka Stock Exchange</option>
                                                                        <option>Investments in Treasury bills</option>
                                                                        <option>Investments in Treasury bonds</option>
                                                                        <option>Foreign investments</option>
                                                                        <option>Any other investments</option>
                                                                    </select>
                                                                    <input type="text" name="assets[2].Description" class="form-control" placeholder="Value / Description" />
                                                                </div>
                                                            </div>
                                                        </td>

                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[2].Files" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(2,1)"
                                                                    aria-label="Upload asset 3"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>4</td>
                                                        <td>Business Current and Capital Accounts (Form 15, Partnership Accounts) <input type="hidden" class="AssetCategory" value="Business Current and Capital Accounts" /></td>
                                                        <td>
                                                            <div id="notesContainer-3">
                                                                <input type="text" name="assets[3].Description" class="form-control mb-2" placeholder="Enter value or notes" />
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[3].Files" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(3,1)"
                                                                    aria-label="Upload asset 4"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr class="table-light align-middle">
                                                        <td>5</td>
                                                        <td>
                                                            Any other assets acquired or gifts received during the year<br />Please provide if you have received any gifts from spouse or children acquition of Assets
                                                            <input type="hidden" class="AssetCategory" value="Any other assets acquired or gifts received" />
                                                        </td>
                                                        <td>
                                                            <div id="notesContainer-4">
                                                                <input type="text" name="assets[4].Description" class="form-control mb-2" placeholder="Enter value or notes" />
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[4].Files" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(4,1)"
                                                                    aria-label="Upload asset 5"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Tab Content: Foreign -->
                                    <div id="manualForeignTab" class="tab-pane fade" style="display: none;">
                                        <div class="table-responsive">
                                            <table class="table table-bordered align-middle">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 50px;background-color: #4aadfd; color: #fff !important">#</th>
                                                        <th style="background-color: #4aadfd; color: #fff !important">Asset Category</th>
                                                        <th style="width: 35%;background-color: #4aadfd; color: #fff !important">Value / Notes</th>
                                                        <th style="width: 25%;background-color: #4aadfd; color: #fff !important">Upload</th>
                                                        <th style="width: 5%;background-color: #4aadfd; color: #fff !important">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="table-light">
                                                        <td>1</td>
                                                        <td>Deed of land, building, apartment <input type="hidden" class="AssetCategory" value="Deed of land, building, apartment" /></td>
                                                        <td>
                                                            <div id="notesContainer-5">
                                                                <input type="text" name="assets[5].Description" class="form-control mb-2" placeholder="Enter value or notes" />
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[5].Files" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(5,2)"
                                                                    aria-label="Upload asset 1"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td>Movable Properties (Motor Vehicles) <input type="hidden" class="AssetCategory" value="Movable Properties (Motor Vehicles)" /></td>
                                                        <td>
                                                            <div id="vehicleNoteContainer-6">
                                                                <div class="vehicle-note-group mb-2 d-flex gap-2">
                                                                    <select class="form-select" name="assets[6].vehicleTypes">
                                                                        <option value="">Select Vehicle Type</option>
                                                                        <option>Motor Car</option>
                                                                        <option>Van</option>
                                                                        <option>Bike</option>
                                                                        <option>Other</option>
                                                                    </select>
                                                                    <input type="text" name="assets[6].Description" class="form-control" placeholder="Value / Description" />
                                                                </div>
                                                            </div>
                                                        </td>

                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[6].Files" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(6,2)"
                                                                    aria-label="Upload asset 2"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr class="table-light">
                                                        <td>3</td>
                                                        <td>Shares/Stocks/Securities as at 31.03.2025 <input type="hidden" class="AssetCategory" value="Shares/Stocks/Securities" /></td>
                                                        <td>
                                                            <div id="institutionTypeNoteContainer-7">
                                                                <div class="institution-note-group mb-2 d-flex gap-2">
                                                                    <select class="form-select mb-2" name="assets[7].InstitutionType">
                                                                        <option value="">Select Institution</option>
                                                                        <option>Share balances on the Sri Lanka Stock Exchange</option>
                                                                        <option>Investments in Treasury bills</option>
                                                                        <option>Investments in Treasury bonds</option>
                                                                        <option>Foreign investments</option>
                                                                        <option>Any other investments</option>
                                                                    </select>
                                                                    <input type="text" name="assets[7].Description" class="form-control" placeholder="Value / Description" />
                                                                </div>
                                                            </div>

                                                        </td>
                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[7].Files" class="form-control form-select" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(7,2)"
                                                                    aria-label="Upload asset 3"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>4</td>
                                                        <td>Business Current and Capital Accounts (Form 15, Partnership Accounts) <input type="hidden" class="AssetCategory" value="Business Current and Capital Accounts" /></td>
                                                        <td>
                                                            <div id="notesContainer-8">
                                                                <input type="text" name="assets[8].Description" class="form-control mb-2" placeholder="Enter value or notes" />
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="file-upload-wrapper">
                                                                <div class="file-input-group mb-2">
                                                                    <input type="file" name="assets[8].Files" class="form-control form-select" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                                                </div>

                                                            </div>
                                                        </td>
                                                        <td class="text-center" style="width: 110px; vertical-align: middle;">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success px-3"
                                                                    style="padding-top: 0.375rem; padding-bottom: 0.375rem; line-height: 1.25; min-height: 32px;"
                                                                    onclick="uploadAsset(8,2)"
                                                                    aria-label="Upload asset 4"
                                                                    title="Upload">
                                                                <i class="bi bi-cloud-upload-fill me-1"></i> Upload
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Submit Button -->
                                    @* <div class="text-end mt-4">
                                        <button type="button" class="btn btn-success px-4 submit-btn" onclick="submitLocalAssets();">Upload</button>
                                </div> *@
                                </form>
                                <div class="card my-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Uploaded Files Summary</h5>
                                        <button class="btn btn-sm btn-outline-primary" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#uploadedFilesCollapse"
                                                aria-expanded="false" aria-controls="uploadedFilesCollapse">
                                            <i class="bi bi-chevron-down" id="toggleIcon"></i>
                                        </button>
                                    </div>
                                    <div class="collapse" id="uploadedFilesCollapse">
                                        <div class="card-body">
                                            <table class="table table-bordered table-striped mt-3" id="uploadedAssetsTable">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Category</th>
                                                        <th>Asset Type</th>
                                                        <th>Asset Note/Value</th>
                                                        <th>File Name</th>
                                                        <th>Uploaded On</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Dynamic rows will be inserted here -->
                                                </tbody>
                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="d-flex justify-content-between">
                            <div class="col-lg-6 col-md-6 btn-prv">
                                <!-- Previous Button -->
                                <button class="btn btn-primary btn-lg" id="btnBankPrevious">
                                    Previous
                                </button>
                            </div>
                            <div class="col-lg-6 col-md-6 right next-btn">
                                <button class="btn btn-primary btn-lg" id="btnOtherNext">
                                    Next
                                </button>
                            </div>
                        </div>

                    </div>

                </div>
                <div id="other-section" class="content-panel p-4 bg-light rounded shadow-sm" style="display: none;">
                    <h4>
                        <i class="fas fa-folder me-2 text-primary"></i>
                        Tax Payment Slips & Other Details
                    </h4>
                    <div class="custom-tabs">
                    <!-- Tabs Nav -->
                    <ul class="nav nav-tabs mt-3" id="taxTabs" role="tablist">
                        <li class="nav-item col-md-2" role="presentation">
                            <button class="nav-link active" id="tax-slips-tab"
                                    data-bs-toggle="tab" data-bs-target="#tax-slips"
                                    type="button" role="tab"
                                    aria-controls="tax-slips" aria-selected="true"
                                    data-category="Tax Payment Slips">
                                <i class="fas fa-file-upload me-1"></i> Tax Payment Slips
                            </button>
                        </li>
                        <li class="nav-item col-md-2" role="presentation">
                            <button class="nav-link" id="income-expenses-tab"
                                    data-bs-toggle="tab" data-bs-target="#income-expenses"
                                    type="button" role="tab"
                                    aria-controls="income-expenses" aria-selected="false"
                                    data-category="Annual Expenses & Balances">
                                <i class="fas fa-wallet me-1"></i>Expenses & Balances
                            </button>
                        </li>
                    </ul>

                    <!-- Tabs Content -->
                    <div class="tab-content mt-3" id="taxTabsContent">

                        <!-- TAB 1: Tax Payment Slips -->
                        <div class="tab-pane fade show active" id="tax-slips" role="tabpanel" aria-labelledby="tax-slips-tab">
                            <div id="other-form" class="upload-form-section">

                                <input type="hidden" name="CategoryName" value="TaxSlips" />

                                <div class="alert alert-info mt-2">
                                    <strong>Note:</strong> Please upload all available tax payment slips here.
                                    If you have any additional documents that should be considered for your tax computation, kindly upload them as well.
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Name of the Document</label>
                                        <input type="text" class="form-control" name="docName" id="otherDocName" />
                                </div>

                                <form method="post" enctype="multipart/form-data">
                                    <div class="mb-3">
                                        <label>Upload File</label>
                                            <input type="file" id="fileInputOther" name="UploadedFile" class="form-control" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt" />
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-primary submit-btn" id="submitOtherBtn">
                                            <i class="fas fa-save me-1"></i> Upload
                                        </button>
                                    </div>
                                </form>

                                <div id="uploadedOtherDocs" class="mt-5" style="display: none;">
                                    <h5 class="mb-3" id="categoryHeading">
                                        <span class="text-muted">Your Uploaded</span>
                                        <span class="badge bg-primary">Other Documents</span>
                                        <span class="text-muted">Documents for 2024/2025</span>
                                    </h5>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-striped mt-2">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>#</th>
                                                    <th>Document Name</th>
                                                    <th>Category</th>
                                                    <th>Employer Name/Any Other Type</th>
                                                    <th>Uploaded On</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="documentsTableOtherBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 2: Income & Expenses -->
                        <div class="tab-pane fade" id="income-expenses" role="tabpanel" aria-labelledby="income-expenses-tab">

                            <!-- Expenses Section -->
                            <div class=" border rounded bg-light shadow-sm ">
                                <h6 class="mb-4 text-primary"><i class="fas fa-wallet me-2"></i> Annual Expenses </h6>
                                <div class="alert alert-info mt-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Note: Please provide your average annual expenses for the period from 1 April 2024 to 31 March 2025.
                                </div>
                                <div class="row g-3">
                                        <div class="col-md-6"><label class="form-label"><span style="color: red">*</span> Living Expenses</label><input type="text" class="form-control numeric-input" name="LivingExpenses" required /></div>
                                        <div class="col-md-6"><label class="form-label">EPF 8%</label><input type="text" class="form-control numeric-input" name="EPF8Percent" /></div>
                                    <div class="col-md-6"><label class="form-label">Fixed Salary Deductions</label><input type="text" class="form-control numeric-input" name="FixedDeductions" /></div>
                                    <div class="col-md-6"><label class="form-label">Children Education Expenses</label><input type="text" class="form-control numeric-input" name="ChildrenEducation" /></div>
                                        <div class="col-md-6"><label class="form-label">Vehicle Expenses</label><input type="text" class="form-control numeric-input" name="VehicleExpenses" /></div>
                                    <div class="col-md-6"><label class="form-label">Medical Expenses</label><input type="text" class="form-control numeric-input" name="MedicalExpenses" /></div>
                                    <div class="col-md-6"><label class="form-label">Loan Re-Payments</label><input type="text" class="form-control numeric-input" name="LoanRepayments" /></div>
                                    <div class="col-md-6"><label class="form-label">Cash Payments for Credit Cards</label><input type="text" class="form-control numeric-input" name="CreditCardPayments" /></div>
                                    <div class="col-md-6"><label class="form-label">House Rent</label><input type="text" class="form-control numeric-input" name="HouseRent" /></div>
                                    <div class="col-md-6"><label class="form-label">Donation</label><input type="text" class="form-control numeric-input" name="Donations" /></div>
                                    <div class="col-md-6"><label class="form-label">Life/Medical Insurance Premium</label><input type="text" class="form-control numeric-input" name="InsurancePremium" /></div>
                                    <div class="col-md-6"><label class="form-label">Any Other Expenses</label><input type="text" class="form-control numeric-input" name="OtherExpenses" /></div>
                                </div>
                            </div>

                            <!-- Balances Section -->
                            <div class=" border rounded bg-light shadow-sm ">
                                <h6 class="mb-4 text-primary"><i class="fas fa-boxes me-2"></i> Balances as at 31.03.2025</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><span style="color: red">*</span> Cash in hand</label>
                                        <input type="text" class="form-control numeric-input" name="CashInHand" required />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Loans given / Receivables</label>
                                        <input type="text" class="form-control numeric-input" name="LoansGiven" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Value of Gold, Silver, Gems, Jewellery</label>
                                        <input type="text" class="form-control numeric-input" name="JewelleryValue" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Disposal of assets</label>
                                        <input type="text" class="form-control numeric-input" name="AssetDisposals" />
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4 d-flex justify-content-end">
                                <button type="button" class="btn btn-success" id="saveFinancialDetailsBtn">
                                    <i class="fas fa-check-circle me-1"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>

                    </div>

                    <!-- Prev / Next -->
                    <div class="d-flex justify-content-between mt-4">
                        <div class="col-lg-6 col-md-6 btn-prv">
                            <button class="btn btn-primary btn-lg" id="btnAssetsPrevious">
                                Previous
                            </button>
                        </div>
                        <div class="col-lg-6 col-md-6 right next-btn">
                            <button class="btn btn-primary btn-lg" id="btnDeclareNext">
                                Next
                            </button>
                        </div>
                    </div>
                </div>



                <div id="declaration-section" class="content-panel p-4 bg-light rounded shadow-sm" style="display: none;">
                    <h4 class="mb-3">Declaration of the Tax Payer</h4>

                    <div class="border rounded p-3 bg-light">
                        <p>
                            I declare to the best of my knowledge and belief that all particulars furnished in the Return of Income are
                            true, correct, and complete. I am aware that making an incorrect, false, or misleading statement is an offence.
                        </p>
                        <div class="alert alert-info d-flex align-items-center mt-3" role="alert" style="font-size: 0.95rem;">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <div>
                                <strong>Note:</strong> All documents uploaded in previous sections (such as <em>Asset Declaration</em>, <em>Bank Confirmation</em>, etc.) will be listed below for your final review before submission.
                            </div>
                        </div>
                        <div id="uploadedDeclarationDocs" style="display: block;">
                            <h5 class="mb-3">Uploaded Documents for Declaration</h5>
                            <table class="table table-bordered table-striped mt-2" id="declarationDocsTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Uploaded On</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rows will be inserted dynamically -->
                                </tbody>
                            </table>
                            <h5 class="mb-3" id="otherTaxHeader">Other Tax Payment Details</h5>
                            <table id="otherTaxPaymentsTable" class="table table-bordered table-striped mt-2">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>Name</th>
                                        <th>Value</th>
                                        <th>Uploaded On</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                        <div class="form-check my-3">
                            <input class="form-check-input no-print" type="checkbox" id="acceptDeclaration">
                            <label class="form-check-label no-print" for="acceptDeclaration">
                                I accept the above declaration.
                            </label>
                        </div>

                        <div class="mt-4 d-flex justify-content-end">
                            <button type="button" class="btn btn-primary no-print" id="submitDeclarationBtn" disabled>
                                Accept and Submit
                            </button>
                            <button type="button" class="btn btn-secondary ms-2 no-print" id="printDeclarationBtn" disabled>
                                🖨️ Print Declaration
                            </button>
                        </div>


                    </div>
                    <div class="d-flex justify-content-between">
                        <div class="col-lg-6 col-md-6 btn-prv">
                            <!-- Previous Button -->
                            <button class="btn btn-primary btn-lg" id="btnOtherPrevious">
                                Previous
                            </button>
                        </div>
                        <div class="col-lg-6 col-md-6 right ">
                            <button class="btn btn-primary btn-lg" id="btnMainDashboardNext" style="display:none;">
                                Finish
                            </button>
                        </div>

                    </div>


                </div>

            </main>
            <!-- Modal Alert Popup -->
            <div id="enhancedModal" class="enhanced-modal" style="display:none;">
                <div class="enhanced-modal-content">
                    <span id="enhancedModalClose" class="enhanced-close">&times;</span>
                    <p id="enhancedModalMessage"></p>
                </div>
            </div>

            <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-warning">
                            <h5 class="modal-title">Warning</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Your uploaded documents will be deleted. Are you sure?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" id="confirmDeleteDocsBtn">Yes</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title" id="confirmDeleteLabel">Confirm Delete</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete this document?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button id="confirmDeleteBtn" type="button" class="btn btn-danger">Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Confirmation Modal -->
            <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header" style="background-color: #cce5ff;">
                            <h5 class="modal-title">Confirmation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            No file uploaded. Do you want to proceed?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                            <button type="button" class="btn btn-primary" id="confirmYes">Yes</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="loadMask" class="load-mask" style="display:none">
                <div class="spinner"></div>
                <div class="load-text">Uploading, please wait...</div>
            </div>
            <input type="hidden" id="docUploadStatus" value="@docStatus" />
            <input type="hidden" id="personalInfoCompleted" value="@personalInfoCompletedStatus" />

            <script src="~/scripts/taxassistedselfonline.js?v=6" asp-append-version="true"></script>
            <script src="~/scripts/taxAssistedDocUpload.js?v=6" asp-append-version="true"></script>
            
        </div>

    </section>
    <!-- /File my taxes -->

</main>
<script>
    const baseApiUrl = "@apiUrl";
    const fileSiteUrl = "@fileSiteUrl";
    const mailUrl = "@mailUrl";
    console.log("Base API URL:", baseApiUrl);
    const userId = '@userId';

    @* window.AppConfig = {
        userId: userId
    }; *@


</script>
<style>
    .disabled-link {
        pointer-events: none;
        opacity: 0.5;
        cursor: not-allowed;
    }

    
    .card-hover {
        transition: all 0.2s ease-in-out;
    }

    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }

    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }

</style>